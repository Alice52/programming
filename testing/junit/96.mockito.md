## intros

1. 主要解决 ioc 类的容器测试问题:

   - 对 bean 做单元测试: 隔离类之间的依赖
   - 主要 mock 请求及返回值

2. annotations

   - @InjectMocks: 表示需要注入 bean 的类, 如被测试类
   - @Mock: 表示要 mock 的数据, `when().thenReturn()` || `when().thenCallRealMethod()`
   - @Spy: 表示所有方法都走真实方式, 如工具类|转换类

   ```java
   @ExtendWith(MockitoExtension.class)
   public class ATest  {
     @InjectMocks private A a=new A();  // new ?
     @InjectMocks private C c= Mockito.spy(new C());;

     @Mock private B b;
     @Spy private D d;

     @BeforeEach
     public void setUp() throws Exception {
       MockitoAnnotations.openMocks(this);
     }

     @ParameterizedTest
     @ValueSource(strings = {"/com/alibaba/cq/springtest/jcode5test/needMockService/A/func.json"})
     public void funcTest(String str) {
       JSONObject arg= TestUtils.getTestArg(str);
       a.func();
       //todo verify the result
     }

   }
   ```

3. mock 数据

   ```java
   Mockito.when(cache.get("KEY")).thenReturn("VALUE");

    // 动态参数, 固定返回值
    Mockito.when(cache.get(Mockito.anyString())).thenReturn("VALUE");

    // 动态参数, 固定返回值
    Mockito.when(cache.get(Mockito.anyString())).then(
       (invocation) -> {
           String key = (String) invocation.getArguments()[0];
           return "VALUE";
    });

    // 固定参数, 异常
    Mockito.when(cache.get("KEY")).thenThrow(new RuntimeException("ERROR"));

    // 验证调用次数
    Mockito.verify(cache.get("KEY"), Mockito.times(1));
   ```

---

## trobling sheet

1. version: jdk & mockito

   - 2.17.0 及之前的版本与 java8 是兼容的

2. static 方法

   - 3.4 之后支持: 之前版本可以结合 PowerMock 使用

## reference

1. [ali-mockito](https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&mid=2247507299&idx=1&sn=52dd86d00396f7f0a69336cabb9bce8b)
2. [note](https://github.com/hehonghui/mockito-doc-zh)
